{"version":3,"file":"unicodesplitter.js","sourceRoot":"","sources":["../../../src/sms/unicodesplitter.ts"],"names":[],"mappings":"AAAA,SAAS,eAAe,CAAC,IAAI;IAC3B,OAAO,IAAI,IAAI,MAAM,IAAI,IAAI,IAAI,MAAM,CAAC;AAC1C,CAAC;AAED,MAAM,CAAC,MAAM,YAAY,GAAG,UAAU,OAAO,EAAE,OAAO;IACpD,OAAO,GAAG,OAAO,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;IAExC,IAAI,OAAO,KAAK,EAAE,EAAE;QAClB,OAAO;YACL,KAAK,EAAE;gBACL;oBACE,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;oBACzC,MAAM,EAAE,CAAC;oBACT,KAAK,EAAE,CAAC;iBACT;aACF;YACD,WAAW,EAAE,CAAC;YACd,UAAU,EAAE,CAAC;SACd,CAAC;KACH;IAED,MAAM,QAAQ,GAAG,EAAE,CAAC;IACpB,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,IAAI,KAAK,GAAG,CAAC,CAAC;IACd,IAAI,UAAU,GAAG,CAAC,CAAC;IACnB,IAAI,WAAW,GAAG,CAAC,CAAC;IACpB,IAAI,SAAS,GAAG,CAAC,CAAC;IAElB,SAAS,IAAI,CAAC,OAAO,GAAG,SAAS;QAC/B,MAAM,GAAG,GAAG;YACV,OAAO,EAAE,OAAO,CAAC,OAAO;gBACtB,CAAC,CAAC,SAAS;gBACX,CAAC,CAAC,OAAO;oBACT,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,GAAG,CAAC,CAAC;oBAC3C,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,SAAS,CAAC;YAChC,MAAM,EAAE,MAAM;YACd,KAAK,EAAE,KAAK;SACb,CAAC;QACF,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEnB,SAAS,GAAG,OAAO,GAAG,CAAC,CAAC;QAExB,WAAW,IAAI,MAAM,CAAC;QACtB,MAAM,GAAG,CAAC,CAAC;QACX,UAAU,IAAI,KAAK,CAAC;QACpB,KAAK,GAAG,CAAC,CAAC;IACZ,CAAC;IAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE;QACtD,MAAM,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACnC,MAAM,aAAa,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC;QAE5C,IAAI,aAAa,EAAE;YACjB,IAAI,KAAK,KAAK,GAAG;gBAAE,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YAC/B,KAAK,IAAI,CAAC,CAAC;YACX,CAAC,EAAE,CAAC;SACL;QAED,KAAK,IAAI,CAAC,CAAC;QACX,MAAM,EAAE,CAAC;QAET,IAAI,KAAK,KAAK,GAAG;YAAE,IAAI,CAAC,CAAC,CAAC,CAAC;KAC5B;IAED,IAAI,KAAK,GAAG,CAAC;QAAE,IAAI,EAAE,CAAC;IAEtB,IAAI,QAAQ,CAAC,CAAC,CAAC,IAAI,UAAU,IAAI,GAAG,EAAE;QACpC,OAAO;YACL,KAAK,EAAE;gBACL;oBACE,OAAO,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO;oBAC9C,MAAM,EAAE,WAAW;oBACnB,KAAK,EAAE,UAAU;iBAClB;aACF;YACD,WAAW,EAAE,WAAW;YACxB,UAAU,EAAE,UAAU;SACvB,CAAC;KACH;IAED,OAAO;QACL,KAAK,EAAE,QAAQ;QACf,WAAW,EAAE,WAAW;QACxB,UAAU,EAAE,UAAU;KACvB,CAAC;AACJ,CAAC,CAAC","sourcesContent":["function isHighSurrogate(code) {\n  return code >= 0xd800 && code <= 0xdbff;\n}\n\nexport const unicodeSplit = function (message, options) {\n  options = options || { summary: false };\n\n  if (message === '') {\n    return {\n      parts: [\n        {\n          content: options.summary ? undefined : '',\n          length: 0,\n          bytes: 0,\n        },\n      ],\n      totalLength: 0,\n      totalBytes: 0,\n    };\n  }\n\n  const messages = [];\n  let length = 0;\n  let bytes = 0;\n  let totalBytes = 0;\n  let totalLength = 0;\n  let partStart = 0;\n\n  function bank(partEnd = undefined) {\n    const msg = {\n      content: options.summary\n        ? undefined\n        : partEnd\n        ? message.substring(partStart, partEnd + 1)\n        : message.substring(partStart),\n      length: length,\n      bytes: bytes,\n    };\n    messages.push(msg);\n\n    partStart = partEnd + 1;\n\n    totalLength += length;\n    length = 0;\n    totalBytes += bytes;\n    bytes = 0;\n  }\n\n  for (let i = 0, count = message.length; i < count; i++) {\n    const code = message.charCodeAt(i);\n    const highSurrogate = isHighSurrogate(code);\n\n    if (highSurrogate) {\n      if (bytes === 132) bank(i - 1);\n      bytes += 2;\n      i++;\n    }\n\n    bytes += 2;\n    length++;\n\n    if (bytes === 134) bank(i);\n  }\n\n  if (bytes > 0) bank();\n\n  if (messages[1] && totalBytes <= 140) {\n    return {\n      parts: [\n        {\n          content: options.summary ? undefined : message,\n          length: totalLength,\n          bytes: totalBytes,\n        },\n      ],\n      totalLength: totalLength,\n      totalBytes: totalBytes,\n    };\n  }\n\n  return {\n    parts: messages,\n    totalLength: totalLength,\n    totalBytes: totalBytes,\n  };\n};\n"]}