{"version":3,"file":"gsmsplitter.js","sourceRoot":"","sources":["../../../src/sms/gsmsplitter.ts"],"names":[],"mappings":"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","sourcesContent":["import { validateCharacter, validateExtendedCharacter } from './gsmvalidator';\n\nfunction isHighSurrogate(code) {\n  return code >= 0xd800 && code <= 0xdbff;\n}\n\nexport const gsmSplit = function (message, options) {\n  options = options || { summary: false };\n\n  if (message === '') {\n    return {\n      parts: [\n        {\n          content: options.summary ? undefined : '',\n          length: 0,\n          bytes: 0,\n        },\n      ],\n      totalLength: 0,\n      totalBytes: 0,\n    };\n  }\n\n  const messages = [];\n  let length = 0;\n  let bytes = 0;\n  let totalBytes = 0;\n  let totalLength = 0;\n  let messagePart = '';\n\n  function bank() {\n    const msg = {\n      content: options.summary ? undefined : messagePart,\n      length: length,\n      bytes: bytes,\n    };\n    messages.push(msg);\n\n    totalLength += length;\n    length = 0;\n    totalBytes += bytes;\n    bytes = 0;\n    messagePart = '';\n  }\n\n  for (let i = 0, count = message.length; i < count; i++) {\n    let c = message.charAt(i);\n\n    if (!validateCharacter(c)) {\n      if (isHighSurrogate(c.charCodeAt(0))) {\n        i++;\n      }\n      c = '\\u0020';\n    } else if (validateExtendedCharacter(c)) {\n      if (bytes === 152) bank();\n      bytes++;\n    }\n\n    bytes++;\n    length++;\n\n    if (!options.summary) messagePart += c;\n\n    if (bytes === 153) bank();\n  }\n\n  if (bytes > 0) bank();\n\n  if (messages[1] && totalBytes <= 160) {\n    return {\n      parts: [\n        {\n          content: options.summary\n            ? undefined\n            : messages[0].content + messages[1].content,\n          length: totalLength,\n          bytes: totalBytes,\n        },\n      ],\n      totalLength: totalLength,\n      totalBytes: totalBytes,\n    };\n  }\n\n  return {\n    parts: messages,\n    totalLength: totalLength,\n    totalBytes: totalBytes,\n  };\n};\n"]}