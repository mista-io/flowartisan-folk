{"version":3,"file":"Select.js","sourceRoot":"","sources":["../../../src/select/Select.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-empty-function */\nimport { TemplateResult, html, css } from 'lit';\nimport { property } from 'lit/decorators';\nimport {\n  getUrl,\n  getClasses,\n  fetchResults,\n  WebResponse,\n  postJSON,\n} from '../utils';\nimport '../options/Options';\nimport { EventHandler } from '../RapidElement';\nimport { FormElement } from '../FormElement';\n\nimport flru from 'flru';\nimport { CompletionOption, CustomEventType, Position } from '../interfaces';\nimport {\n  renderCompletionOption,\n  updateInputElementWithCompletion,\n  executeCompletionQuery,\n} from '../completion/helpers';\nimport { Store } from '../store/Store';\nimport { styleMap } from 'lit-html/directives/style-map';\n\nconst LOOK_AHEAD = 20;\n\nexport class Select extends FormElement {\n  static get styles() {\n    return css`\n      :host {\n        font-family: var(--font-family);\n        transition: all ease-in-out var(--transition-speed);\n        display: inline;\n        line-height: normal;\n        outline: none;\n        position: relative;\n        --icon-color: var(--color-text-dark-secondary);\n      }\n\n      temba-options {\n        --temba-options-font-size: var(--temba-select-selected-font-size);\n        --icon-color: var(--color-text-dark);\n        z-index: 3;\n      }\n\n      :host:focus {\n        outline: none;\n      }\n\n      #anchor {\n        position: absolute;\n        visibility: hidden;\n        width: 250px;\n        height: 25px;\n      }\n\n      .remove-item {\n        cursor: pointer;\n        display: inline-block;\n        padding: 3px 6px;\n        border-right: 1px solid rgba(100, 100, 100, 0.2);\n        margin: 0;\n        background: rgba(100, 100, 100, 0.05);\n      }\n\n      .selected-item.multi .remove-item {\n        display: none;\n      }\n\n      .remove-item:hover {\n        background: rgba(100, 100, 100, 0.1);\n      }\n\n      input:focus {\n        outline: none;\n        box-shadow: none;\n        cursor: text;\n      }\n\n      .select-container {\n        display: flex;\n        flex-direction: row;\n        flex-wrap: nowrap;\n        align-items: center;\n        border: 1px solid var(--color-widget-border);\n        transition: all ease-in-out var(--transition-speed);\n        cursor: pointer;\n        border-radius: var(--curvature-widget);\n        background: var(--color-widget-bg);\n        padding-top: 1px;\n        box-shadow: 0 3px 20px 0 rgba(0, 0, 0, 0.04),\n          0 1px 2px 0 rgba(0, 0, 0, 0.02);\n\n        position: relative;\n        z-index: 2;\n      }\n\n      temba-icon[name='chevron-down']:hover,\n      .clear-button:hover {\n        --icon-color: var(--color-text-dark);\n      }\n\n      .select-container:focus {\n        outline: none;\n      }\n\n      .select-container.multi {\n        /* background: var(--color-widget-bg); */\n      }\n\n      .select-container.focused {\n        background: var(--color-widget-bg-focused);\n        border-color: var(--color-focus);\n        box-shadow: var(--widget-box-shadow-focused);\n      }\n\n      .left-side {\n        flex: 1;\n      }\n\n      .empty .selected {\n      }\n\n      .empty .placeholder {\n        display: block;\n      }\n\n      .selected {\n        display: flex;\n        flex-direction: row;\n        align-items: stretch;\n        user-select: none;\n        padding: var(--temba-select-selected-padding);\n      }\n\n      .searchable .selected {\n        padding: 4px !important;\n      }\n\n      .multi .selected {\n        flex-wrap: wrap;\n        padding: 4px;\n      }\n\n      .multi.empty .selected {\n        padding: var(--temba-select-selected-padding);\n      }\n\n      .selected .selected-item {\n        display: flex;\n        overflow: hidden;\n        color: var(--color-widget-text);\n        line-height: var(--temba-select-selected-line-height);\n        --icon-color: var(--color-text-dark);\n      }\n\n      .multi .selected .selected-item {\n        vertical-align: middle;\n        background: rgba(100, 100, 100, 0.1);\n        user-select: none;\n        border-radius: 2px;\n        align-items: stretch;\n        flex-direction: row;\n        flex-wrap: nowrap;\n        margin: 2px 2px;\n      }\n\n      .selected-item .option-name {\n        padding: 0px;\n        font-size: var(--temba-select-selected-font-size);\n        align-self: center;\n      }\n\n      .multi .selected-item .option-name {\n        flex: 1 1 auto;\n        align-self: center;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        font-size: 12px;\n        padding: 2px 8px;\n      }\n\n      .multi .selected .selected-item.focused {\n        background: rgba(100, 100, 100, 0.3);\n      }\n\n      input {\n        font-size: 13px;\n        width: 0px;\n        cursor: pointer;\n        background: none;\n        resize: none;\n        border: none !important;\n        visibility: visible;\n        line-height: inherit !important;\n        height: var(--search-input-height) !important;\n        margin: 0px !important;\n        padding: 0px !important;\n        box-shadow: none !important;\n        font-family: var(--font-family);\n        caret-color: var(--input-caret);\n      }\n\n      input:focus {\n        box-shadow: none !important;\n      }\n\n      .searchable.no-search-input .input-wrapper {\n        flex-grow: inherit;\n        min-width: 1px;\n      }\n\n      .searchable.no-search-input.empty .input-wrapper {\n        flex-grow: 1;\n        min-width: 1px;\n      }\n\n      .searchable.no-search-input .input-wrapper .searchbox {\n        flex-grow: inherit;\n        min-width: 1px;\n      }\n\n      .searchable .input-wrapper .searchbox {\n        flex-grow: 1;\n        min-width: 100%;\n        height: 100%;\n      }\n\n      .searchable.single.search-input .selected .selected-item {\n        display: none;\n      }\n\n      .searchable.single.no-search-input\n        .selected\n        .input-wrapper\n        input.searchbox {\n        padding: 6px 2px !important;\n      }\n\n      .searchable.single.no-search-input.empty\n        .selected\n        .input-wrapper\n        input.searchbox {\n        padding: 6px 6px !important;\n      }\n\n      .empty input {\n        width: 100%;\n      }\n\n      .searchable input {\n        padding: 6px 4px !important;\n      }\n\n      .searchable input {\n        font-weight: 300;\n        visibility: visible;\n        cursor: pointer;\n        background: none;\n        color: var(--color-text);\n        resize: none;\n        box-shadow: none !important;\n        flex-grow: 1;\n        border: none;\n        caret-color: var(--input-caret);\n      }\n\n      .searchable input:focus {\n        box-shadow: none !important;\n      }\n\n      .input-wrapper {\n        flex-grow: 1;\n      }\n\n      .input-wrapper .searchbox {\n      }\n\n      .searchbox {\n        border: 0px;\n      }\n\n      .searchbox::placeholder {\n        color: var(--color-placeholder);\n        font-weight: 300;\n        font-size: 1.1em;\n        line-height: var(--temba-select-selected-line-height);\n        padding-left: 1px;\n      }\n\n      .placeholder {\n        font-size: var(--temba-select-selected-font-size);\n        color: var(--color-placeholder);\n        display: none;\n        font-weight: 300;\n        line-height: var(--temba-select-selected-line-height);\n      }\n\n      .footer {\n        padding: 5px 10px;\n        background: var(--color-primary-light);\n        color: rgba(0, 0, 0, 0.5);\n        font-size: 80%;\n        border-bottom-left-radius: var(--curvature-widget);\n        border-bottom-right-radius: var(--curvature-widget);\n      }\n\n      .small {\n        --temba-select-selected-padding: 7px;\n        --temba-select-selected-line-height: 13px;\n        --temba-select-selected-font-size: 12px;\n        --search-input-height: 7px !important;\n      }\n\n      .info-text {\n        opacity: 1;\n        transition: margin var(--transition-speed) ease-in-out;\n        margin-bottom: 16px;\n        margin-top: -1em;\n        padding: 0.5em 1em;\n        background: #f3f3f3;\n        padding-top: 1.5em;\n        border-radius: var(--curvature);\n        font-size: 0.9em;\n        color: rgba(0, 0, 0, 0.5);\n        box-shadow: inset 0px 0px 4px rgb(0 0 0 / 10%);\n        z-index: 1;\n        position: relative;\n      }\n\n      .info-text.focused {\n        opacity: 1;\n      }\n\n      .info-text.hide {\n        opacity: 0;\n        max-height: 0;\n        margin-bottom: 0px;\n        margin-top: -2em;\n        pointer-events: none;\n      }\n    `;\n  }\n\n  @property({ type: Boolean })\n  multi = false;\n\n  @property({ type: Boolean })\n  searchOnFocus = false;\n\n  @property({ type: String })\n  placeholder = '';\n\n  @property()\n  name = '';\n\n  @property()\n  endpoint: string;\n\n  @property({ type: String })\n  nameKey = 'name';\n\n  @property({ type: String })\n  valueKey = 'value';\n\n  @property({ attribute: false })\n  currentFunction: CompletionOption;\n\n  @property({ type: String })\n  queryParam: string = null;\n\n  @property({ type: String })\n  input = '';\n\n  @property({ type: Array })\n  visibleOptions: any[] = [];\n\n  @property({ type: Array })\n  completionOptions: CompletionOption[] = [];\n\n  @property({ type: Number })\n  quietMillis = 0;\n\n  @property({ type: Boolean })\n  fetching: boolean;\n\n  @property({ type: Boolean })\n  searchable = false;\n\n  @property({ type: String })\n  expressions: string;\n\n  @property({ type: Boolean })\n  cache = true;\n\n  @property({ type: String })\n  cacheKey = '';\n\n  @property({ type: Boolean })\n  focused = false;\n\n  @property({ type: Boolean })\n  disabled = false;\n\n  @property({ attribute: false })\n  selectedIndex = -1;\n\n  @property({ type: Number })\n  cursorIndex: number;\n\n  @property({ attribute: false })\n  anchorElement: HTMLElement;\n\n  @property({ attribute: false })\n  anchorExpressions: HTMLElement;\n\n  @property({ type: Object })\n  anchorPosition: Position = { left: 0, top: 0 };\n\n  @property({ type: Boolean })\n  tags = false;\n\n  @property({ type: Boolean, attribute: 'space_select' })\n  spaceSelect: boolean;\n\n  @property({ type: Boolean })\n  jsonValue: boolean;\n\n  @property({ type: Boolean })\n  hideErrors: boolean;\n\n  @property({ type: Boolean })\n  clearable: boolean;\n\n  @property({ type: String })\n  flavor = 'default';\n\n  @property({ type: String, attribute: 'info_text' })\n  infoText = '';\n\n  @property({ attribute: false })\n  getName: (option: any) => string = (option: any) =>\n    option[this.nameKey || 'name'];\n\n  @property({ attribute: false })\n  isMatch: (option: any, q: string) => boolean = (option: any, q: string) => {\n    const name = this.getName(option) || '';\n    return name.toLowerCase().indexOf(q) > -1;\n  };\n\n  @property({ attribute: false })\n  getValue: (option: any) => string = (option: any) =>\n    option[this.valueKey || 'value'] || option.id;\n\n  @property({ attribute: false })\n  shouldExclude: (option: any) => boolean;\n\n  @property({ attribute: false })\n  sortFunction: (a: any, b: any) => number;\n\n  @property({ attribute: false })\n  renderOption: (option: any, selected: boolean) => TemplateResult;\n\n  @property({ attribute: false })\n  renderOptionName: (option: any, selected: boolean) => TemplateResult;\n\n  @property({ attribute: false })\n  renderOptionDetail: (option: any, selected: boolean) => TemplateResult = () =>\n    html``;\n\n  @property({ attribute: false })\n  renderSelectedItem: (option: any) => TemplateResult =\n    this.renderSelectedItemDefault;\n\n  @property({ attribute: false })\n  createArbitraryOption: (input: string, options: any[]) => any =\n    this.createArbitraryOptionDefault;\n\n  @property({ attribute: false })\n  getOptions: (response: WebResponse) => any[] = this.getOptionsDefault;\n\n  @property({ attribute: false })\n  isComplete: (newestOptions: any[], response: WebResponse) => boolean =\n    this.isCompleteDefault;\n\n  @property({ type: Array, attribute: 'options' })\n  private staticOptions: any[] = [];\n\n  private lastQuery: number;\n\n  // private cancelToken: CancelTokenSource;\n  private complete: boolean;\n  private page: number;\n  private next: string = null;\n  private query: string;\n\n  private removingSelection: boolean;\n\n  private lruCache = flru(20);\n\n  // http promise to monitor for completeness\n  public httpComplete: Promise<void | WebResponse>;\n\n  public updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n\n    // if our cache key changes, clear it out\n    if (changedProperties.has('cacheKey')) {\n      this.lruCache.clear(false);\n    }\n\n    if (\n      changedProperties.has('input') &&\n      !changedProperties.has('values') &&\n      !changedProperties.has('options') &&\n      this.focused\n    ) {\n      if (this.lastQuery) {\n        window.clearTimeout(this.lastQuery);\n      }\n\n      this.lastQuery = window.setTimeout(() => {\n        if (this.expressions && this.input.indexOf('@') > -1) {\n          this.fetchExpressions();\n        } else {\n          this.fetchOptions(this.input);\n        }\n      }, this.quietMillis);\n    }\n\n    // if our cursor changed, lets make sure our scrollbox is showing it\n    if (\n      (changedProperties.has('cursorIndex') ||\n        changedProperties.has('visibleOptions')) &&\n      this.endpoint &&\n      !this.fetching\n    ) {\n      if (\n        (this.visibleOptions.length > 0 || this.next) &&\n        !this.complete &&\n        (this.cursorIndex || 0) > this.visibleOptions.length - LOOK_AHEAD\n      ) {\n        this.fetchOptions(this.query, this.page + 1);\n      }\n    }\n\n    // if they set an inital value, look through our static options for it\n    if (changedProperties.has('value') && this.value) {\n      const existing = this.staticOptions.find(option => {\n        return this.getValue(option) === this.value;\n      });\n\n      if (existing) {\n        this.setValue(existing);\n      }\n    }\n\n    // default to the first option if we don't have a placeholder\n    if (\n      this.values.length === 0 &&\n      !this.placeholder &&\n      this.staticOptions.length > 0\n    ) {\n      this.setValue(this.staticOptions[0]);\n    }\n  }\n\n  private setSelectedOption(option: any) {\n    if (this.multi) {\n      this.addValue(option);\n    } else {\n      this.setValue(option);\n    }\n\n    if (!this.multi || !this.searchable) {\n      this.blur();\n      this.focused = false;\n    }\n\n    this.visibleOptions = [];\n    this.input = '';\n    this.next = null;\n    this.complete = true;\n    this.selectedIndex = -1;\n\n    this.fireEvent('change');\n  }\n\n  public handleOptionSelection(event: CustomEvent) {\n    const selected = event.detail.selected;\n    // check if we should post it\n    if (selected.post && this.endpoint) {\n      postJSON(this.endpoint, selected).then(response => {\n        if (response.status >= 200 && response.status < 300) {\n          this.setSelectedOption(response.json);\n          this.lruCache = flru(20);\n        } else {\n          // TODO: find a way to share inline errors\n          this.blur();\n        }\n      });\n    } else {\n      this.setSelectedOption(selected);\n    }\n  }\n\n  private handleExpressionSelection(evt: CustomEvent) {\n    const option = evt.detail.selected as CompletionOption;\n    const tabbed = evt.detail.tabbed;\n\n    const ele = this.shadowRoot.querySelector('.searchbox') as HTMLInputElement;\n    updateInputElementWithCompletion(this.query, ele, option);\n\n    this.query = '';\n    this.completionOptions = [];\n\n    if (tabbed) {\n      this.fetchExpressions();\n    } else if (this.input.indexOf('(') === -1) {\n      this.addInputAsValue();\n    }\n  }\n\n  private getNameInternal: (option: any) => string = (option: any) => {\n    return this.getName(option);\n  };\n\n  private getOptionsDefault(response: WebResponse): any[] {\n    return response.json['results'];\n  }\n\n  private isCompleteDefault(\n    newestOptions: any[],\n    response: WebResponse\n  ): boolean {\n    const json = response.json;\n    return !json['more'] && !json['next'];\n  }\n\n  public handleRemoveSelection(selectionToRemove: any): void {\n    this.removeValue(selectionToRemove);\n    this.visibleOptions = [];\n    this.fireEvent('change');\n  }\n\n  private createArbitraryOptionDefault(): any {\n    return null;\n  }\n\n  public open(): void {\n    this.requestUpdate('input');\n  }\n\n  public isOpen(): boolean {\n    return this.visibleOptions.length > 0;\n  }\n\n  public setOptions(options: any[]): void {\n    this.staticOptions = options;\n  }\n\n  private setVisibleOptions(options: any[]) {\n    // if we have an exclusion filter apply it\n    options = options.filter(option => {\n      // exclude unnamed\n      if (!this.getNameInternal(option)) {\n        return false;\n      }\n\n      if (this.shouldExclude) {\n        return !this.shouldExclude(option);\n      }\n      return true;\n    });\n\n    if (this.input) {\n      // if we are searching locally, filter for the query\n      if (this.searchable && !this.queryParam) {\n        const q = this.input.trim().toLowerCase();\n        options = options.filter((option: any) => this.isMatch(option, q));\n      }\n\n      const arbitraryOption: any = this.createArbitraryOption(\n        this.input,\n        options\n      );\n\n      if (arbitraryOption) {\n        // set our arbitrary flag so we never have more than one\n        arbitraryOption.arbitrary = true;\n\n        // make sure our id is not already present\n        const exists = options.find(\n          (option: any) =>\n            this.getValue(option) === this.getValue(arbitraryOption)\n        );\n\n        if (!exists) {\n          if (options.length > 0) {\n            if (options[0].arbitrary) {\n              options[0] = arbitraryOption;\n            } else {\n              options.unshift(arbitraryOption);\n            }\n          } else {\n            options.unshift(arbitraryOption);\n          }\n        }\n      }\n    }\n\n    // filter out any options already selected by id\n    // TODO: should maybe be doing a deep equals here with option to optimize\n    if (this.values.length > 0) {\n      if (this.multi) {\n        options = options.filter(\n          option =>\n            !this.values.find(\n              selected => this.getValue(selected) === this.getValue(option)\n            )\n        );\n      } else {\n        // if no search, single select should set our cursor to the selected item\n        if (!this.input) {\n          this.cursorIndex = options.findIndex(\n            option => this.getValue(option) === this.getValue(this.values[0])\n          );\n        } else {\n          this.cursorIndex = 0;\n        }\n        this.requestUpdate('cursorIndex');\n      }\n    }\n\n    // finally sort\n    if (this.sortFunction) {\n      options.sort(this.sortFunction);\n    }\n\n    this.visibleOptions = options;\n  }\n\n  public fetchExpressions() {\n    const store: Store = document.querySelector('temba-store');\n    if (this.expressions && store) {\n      const ele = this.shadowRoot.querySelector(\n        '.searchbox'\n      ) as HTMLInputElement;\n\n      const result = executeCompletionQuery(\n        ele,\n        store,\n        this.expressions === 'session'\n      );\n      this.query = result.query;\n      this.completionOptions = result.options;\n      this.visibleOptions = [];\n      this.anchorPosition = result.anchorPosition;\n      return;\n    }\n  }\n\n  public fetchOptions(query: string, page = 0) {\n    this.completionOptions = [];\n\n    if (!this.fetching) {\n      this.fetching = true;\n\n      // make sure we cancel any previous request\n      // if (this.cancelToken) {\n      // this.cancelToken.cancel();\n      // }\n\n      const options: any = [...this.staticOptions];\n      const q = (query || '').trim().toLowerCase();\n\n      if (this.tags && q) {\n        if (\n          !options.find(\n            (option: any) =>\n              this.getValue(option) && this.getValue(option).toLowerCase() === q\n          )\n        ) {\n          options.splice(0, 0, { name: query, value: query });\n        }\n      }\n\n      if (this.endpoint) {\n        let url = this.endpoint;\n\n        if (query && this.queryParam) {\n          if (url.indexOf('?') > -1) {\n            url += '&';\n          } else {\n            url += '?';\n          }\n\n          url += this.queryParam + '=' + encodeURIComponent(query);\n        }\n\n        if (page) {\n          if (url.indexOf('?') > -1) {\n            url += '&';\n          } else {\n            url += '?';\n          }\n          url += 'page=' + page;\n        }\n\n        if (this.next) {\n          url = this.next;\n        }\n\n        if (this.cache && !this.tags && this.lruCache.has(url)) {\n          const cache = this.lruCache.get(url);\n          if (page === 0 && !this.next) {\n            this.cursorIndex = 0;\n            this.setVisibleOptions([...options, ...cache.options]);\n          } else {\n            this.setVisibleOptions([...this.visibleOptions, ...cache.options]);\n          }\n\n          this.complete = cache.complete;\n          this.next = cache.next;\n          this.fetching = false;\n          return;\n        }\n\n        // if we are searchable, but doing it locally, fetch all the options\n        if (this.searchable && !this.queryParam) {\n          fetchResults(url).then((results: any) => {\n            if (this.cache && !this.tags) {\n              this.lruCache.set(url, {\n                options: results,\n                complete: true,\n                next: null,\n              });\n\n              this.complete = true;\n              this.next = null;\n              this.setVisibleOptions([...options, ...results]);\n              this.fetching = false;\n            }\n          });\n        } else {\n          this.httpComplete = getUrl(url)\n            .then((response: WebResponse) => {\n              const results = this.getOptions(response).filter(\n                (option: any) => {\n                  return this.isMatch(option, q);\n                }\n              );\n\n              const json = response.json;\n              if (json['next']) {\n                this.next = json['next'];\n              }\n\n              if (page === 0 && !this.next) {\n                this.cursorIndex = 0;\n                this.setVisibleOptions([...options, ...results]);\n                this.query = query;\n                this.complete = this.isComplete(this.visibleOptions, response);\n              } else {\n                if (results.length > 0) {\n                  this.setVisibleOptions([...this.visibleOptions, ...results]);\n                }\n                this.complete = this.isComplete(results, response);\n              }\n\n              if (this.cache && !this.tags) {\n                this.lruCache.set(url, {\n                  options: results,\n                  complete: this.complete,\n                  next: this.next,\n                });\n              }\n\n              this.fetching = false;\n              this.page = page;\n            })\n            .catch((reason: any) => {\n              // cancelled\n              this.fetching = false;\n              console.error(reason);\n            });\n        }\n      } else {\n        this.fetching = false;\n        this.setVisibleOptions(options);\n      }\n    }\n  }\n\n  private handleFocus(): void {\n    if (!this.focused && this.visibleOptions.length === 0) {\n      this.focused = true;\n      if (this.searchOnFocus && !this.removingSelection) {\n        this.requestUpdate('input');\n      }\n    }\n  }\n\n  private handleBlur() {\n    this.focused = false;\n    if (this.visibleOptions.length > 0) {\n      this.input = '';\n      this.next = null;\n      this.complete = true;\n      this.visibleOptions = [];\n      this.cursorIndex = 0;\n    }\n  }\n\n  private handleClick(): void {\n    this.selectedIndex = -1;\n    this.requestUpdate('input');\n  }\n\n  private addInputAsValue() {\n    const ele = this.shadowRoot.querySelector('.searchbox') as HTMLInputElement;\n    const expression = {\n      name: ele.value,\n      value: ele.value,\n      expression: true,\n    };\n\n    if (this.multi) {\n      if (\n        !this.values.find(option => {\n          return (\n            option.expression &&\n            option.value &&\n            expression.value &&\n            option.value.toLowerCase().trim() ==\n              expression.value.toLowerCase().trim()\n          );\n        })\n      ) {\n        this.addValue(expression);\n      }\n    } else {\n      this.setValue(expression);\n    }\n    this.input = '';\n    if (!this.multi) {\n      this.blur();\n    }\n\n    this.fireEvent('change');\n  }\n\n  private handleKeyDown(evt: KeyboardEvent) {\n    // if we are completing an expression, select it\n    if (\n      evt.key === 'Enter' &&\n      this.expressions &&\n      this.completionOptions.length === 0 &&\n      this.input.indexOf('@') > -1\n    ) {\n      this.addInputAsValue();\n    }\n\n    // see if we should open our options on a key event\n    if (\n      evt.key === 'Enter' ||\n      evt.key === 'ArrowDown' ||\n      (evt.key === 'n' && evt.ctrlKey)\n    ) {\n      if (\n        this.visibleOptions.length === 0 &&\n        this.completionOptions.length === 0\n      ) {\n        this.requestUpdate('input');\n        return;\n      }\n    }\n\n    // focus our last item on delete\n    if (this.multi && evt.key === 'Backspace' && !this.input) {\n      if (this.visibleOptions.length > 0) {\n        this.visibleOptions = [];\n        return;\n      }\n\n      if (this.selectedIndex === -1) {\n        this.selectedIndex = this.values.length - 1;\n        this.visibleOptions = [];\n      } else {\n        this.popValue();\n        this.selectedIndex = -1;\n      }\n      this.fireEvent('change');\n    } else {\n      this.selectedIndex = -1;\n    }\n  }\n\n  public getStaticOptions() {\n    return this.staticOptions;\n  }\n\n  private handleInput(evt: KeyboardEvent) {\n    const ele = evt.currentTarget as HTMLInputElement;\n    this.input = ele.value;\n  }\n\n  private handleCancel() {\n    this.visibleOptions = [];\n  }\n\n  private handleCursorChanged(event: CustomEvent) {\n    this.cursorIndex = event.detail.index;\n  }\n\n  private handleContainerClick(event: MouseEvent) {\n    this.focused = true;\n\n    if ((event.target as any).tagName !== 'INPUT') {\n      const input = this.shadowRoot.querySelector('input');\n      if (input) {\n        input.click();\n        input.focus();\n        return;\n      }\n\n      if (this.visibleOptions.length > 0) {\n        this.visibleOptions = [];\n        event.preventDefault();\n        event.stopPropagation();\n      } else {\n        this.requestUpdate('input');\n      }\n    }\n  }\n\n  public getEventHandlers(): EventHandler[] {\n    return [\n      { event: CustomEventType.Canceled, method: this.handleCancel },\n      {\n        event: CustomEventType.CursorChanged,\n        method: this.handleCursorChanged,\n      },\n      { event: 'blur', method: this.handleBlur },\n      { event: 'focus', method: this.handleFocus },\n    ];\n  }\n\n  public firstUpdated(changedProperties: any) {\n    super.firstUpdated(changedProperties);\n\n    this.anchorElement = this.shadowRoot.querySelector('.select-container');\n    this.anchorExpressions = this.shadowRoot.querySelector('#anchor');\n\n    // wait until children are created before adding our static options\n    window.setTimeout(() => {\n      for (const child of this.children) {\n        if (child.tagName === 'TEMBA-OPTION') {\n          const option: any = {};\n          for (const attribute of child.attributes) {\n            option[attribute.name] = attribute.value;\n          }\n          this.staticOptions.push(option);\n\n          if (\n            child.getAttribute('selected') !== null ||\n            this.getValue(option) == this.value\n          ) {\n            if (this.getAttribute('multi') !== null) {\n              this.addValue(option);\n            } else {\n              this.setValue(option);\n            }\n          }\n        }\n      }\n\n      if (this.values.length === 0 && !this.placeholder) {\n        if (this.staticOptions.length == 0 && this.endpoint) {\n          // see if we need to auto select the first item but need to fetch it\n          fetchResults(this.endpoint).then((results: any) => {\n            if (results.length > 0) {\n              this.setValue(results[0]);\n              this.fireEvent('change');\n            }\n          });\n        } else {\n          if (this.getAttribute('multi') !== null) {\n            this.addValue(this.staticOptions[0]);\n          } else {\n            this.setValue(this.staticOptions[0]);\n          }\n          this.fireEvent('change');\n        }\n      }\n\n      if (this.searchable && this.staticOptions.length === 0) {\n        this.quietMillis = 200;\n      }\n    }, 0);\n  }\n\n  private handleArrowClick(event: MouseEvent): void {\n    if (this.visibleOptions.length > 0) {\n      this.visibleOptions = [];\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  private renderSelectedItemDefault(option: any): TemplateResult {\n    return html`\n      <div class=\"option-name\" style=\"display:flex\">\n        ${option.icon\n          ? html`<temba-icon\n              name=\"${option.icon}\"\n              style=\"margin-right:0.5em;\"\n            ></temba-icon>`\n          : null}<span>${this.getName(option)}</span>\n      </div>\n    `;\n  }\n\n  public serializeValue(value: any): string {\n    // static options just use their value\n    if (!this.jsonValue && (this.staticOptions.length > 0 || this.tags)) {\n      return value.value;\n    }\n\n    return super.serializeValue(value);\n  }\n\n  public setSelection(value: string): void {\n    for (const option of this.staticOptions) {\n      if (option.value === value) {\n        if (this.values.length === 0 || this.values[0].value !== '' + value) {\n          this.setValue(option);\n          this.fireEvent('change');\n        }\n        return;\n      }\n    }\n  }\n\n  private handleClear(evt: MouseEvent): void {\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.setValues([]);\n    this.fireEvent('change');\n  }\n\n  public render(): TemplateResult {\n    const placeholder = this.values.length === 0 ? this.placeholder : '';\n    const placeholderDiv = html`\n      <div class=\"placeholder\">${placeholder}</div>\n    `;\n\n    const clear =\n      this.clearable && this.values.length > 0 && !this.multi\n        ? html`<temba-icon\n            name=\"x\"\n            size=\"1.1\"\n            class=\"clear-button\"\n            @click=${this.handleClear}\n          />`\n        : null;\n\n    const classes = getClasses({\n      multi: this.multi,\n      single: !this.multi,\n      searchable: this.searchable,\n      empty: this.values.length === 0,\n      options: this.visibleOptions.length > 0,\n      focused: this.focused,\n      'search-input': this.input.length > 0,\n      'no-search-input': this.input.length === 0,\n      [this.flavor]: this.flavor !== null,\n      disabled: this.disabled,\n    });\n\n    const anchorStyles = this.anchorPosition\n      ? {\n          top: '0px',\n          left: `${this.anchorPosition.left - 10}px`,\n        }\n      : {};\n\n    const input = this.searchable\n      ? html`\n          <div class=\"input-wrapper\">\n            <input\n              class=\"searchbox\"\n              @input=${this.handleInput}\n              @keydown=${this.handleKeyDown}\n              @click=${this.handleClick}\n              type=\"text\"\n              placeholder=${placeholder}\n              .value=${this.input}\n            />\n            <div id=\"anchor\" style=${styleMap(anchorStyles)}></div>\n          </div>\n        `\n      : placeholderDiv;\n\n    return html`\n      <temba-field\n        name=${this.name}\n        .label=${this.label}\n        .helpText=${this.helpText}\n        .errors=${this.errors}\n        .widgetOnly=${this.widgetOnly}\n        .hideErrors=${this.hideErrors}\n        ?disabled=${this.disabled}\n      >\n  \n      \n        <div\n          tabindex=\"0\"\n          class=\"select-container ${classes}\"\n          @click=${this.handleContainerClick}\n        >          \n          <div class=\"left-side\">\n            <div class=\"selected\">\n              ${!this.multi ? input : null}\n              ${this.values.map(\n                (selected: any, index: number) => html`\n                  <div\n                    class=\"selected-item ${index === this.selectedIndex\n                      ? 'focused'\n                      : ''}\"\n                  >\n                    ${this.multi\n                      ? html`\n                          <div\n                            class=\"remove-item\"\n                            style=\"margin-top:1px\"\n                            @mousedown=${() => {\n                              this.removingSelection = true;\n                            }}\n                            @mouseup=${() => {\n                              this.removingSelection = false;\n                            }}\n                            @click=${(evt: MouseEvent) => {\n                              evt.preventDefault();\n                              evt.stopPropagation();\n                              this.handleRemoveSelection(selected);\n                            }}\n                          >\n                            <temba-icon name=\"x\" size=\"1\" />\n                          </div>\n                        `\n                      : null}\n                    ${this.renderSelectedItem(selected)}\n                  </div>\n                `\n              )}\n              ${this.multi ? input : null}\n            </div>\n          </div>\n\n          ${clear}\n\n          ${\n            !this.tags\n              ? html`<div\n                  class=\"right-side\"\n                  style=\"display:block;margin-right:5px\"\n                  @click=${this.handleArrowClick}\n                >\n                  <temba-icon\n                    size=\"1.5\"\n                    name=\"chevron-down\"\n                    class=\"${this.visibleOptions.length > 0 ? 'open' : ''}\"\n                  />\n                </div>`\n              : null\n          }\n          </div>\n          \n        </div>\n        <div class=\"info-text ${!this.infoText ? 'hide' : ''} ${\n      this.focused ? 'focused' : ''\n    }\">${this.infoText}</div>\n    \n    <temba-options\n    @temba-selection=${this.handleOptionSelection}\n    .cursorIndex=${this.cursorIndex}\n    .renderOptionDetail=${this.renderOptionDetail}\n    .renderOptionName=${this.renderOptionName}\n    .renderOption=${this.renderOption}\n    .anchorTo=${this.anchorElement}\n    .options=${this.visibleOptions}\n    .spaceSelect=${this.spaceSelect}\n    .nameKey=${this.nameKey}\n    .getName=${this.getNameInternal}\n    ?visible=${this.visibleOptions.length > 0}\n  ></temba-options>\n\n    <temba-options\n    @temba-selection=${this.handleExpressionSelection}\n    @temba-canceled=${() => {}}\n    .anchorTo=${this.anchorExpressions}\n    .options=${this.completionOptions}\n    .renderOption=${renderCompletionOption}\n    ?visible=${this.completionOptions.length > 0}\n    >\n      ${\n        this.currentFunction\n          ? html`\n              <div class=\"current-fn\">\n                ${renderCompletionOption(this.currentFunction, true)}\n              </div>\n            `\n          : null\n      }\n      <div class=\"footer\">Tab to complete, enter to select</div>\n    </temba-options>\n\n\n\n        </temba-field>\n    \n    `;\n  }\n}\n"]}