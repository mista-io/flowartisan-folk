{"version":3,"file":"Store.js","sourceRoot":"","sources":["../../../src/store/Store.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement } from 'lit';\nimport { property } from 'lit/decorators';\nimport { getUrl, getAssets, Asset, WebResponse } from '../utils';\nimport {\n  ContactField,\n  ContactGroup,\n  CompletionOption,\n  CompletionSchema,\n  KeyedAssets,\n} from '../interfaces';\n\nexport class Store extends LitElement {\n  @property({ type: String, attribute: 'completion' })\n  completionEndpoint: string;\n\n  @property({ type: String, attribute: 'fields' })\n  fieldsEndpoint: string;\n\n  @property({ type: String, attribute: 'groups' })\n  groupsEndpoint: string;\n\n  @property({ type: String, attribute: 'globals' })\n  globalsEndpoint: string;\n\n  @property({ type: Object, attribute: false })\n  private schema: CompletionSchema;\n\n  @property({ type: Object, attribute: false })\n  private fnOptions: CompletionOption[];\n\n  @property({ type: Object, attribute: false })\n  private keyedAssets: KeyedAssets = {};\n\n  private fields: { [key: string]: ContactField } = {};\n  private groups: { [uuid: string]: ContactGroup } = {};\n\n  // http promise to monitor for completeness\n  public httpComplete: Promise<void | WebResponse[]>;\n\n  public firstUpdated() {\n    const fetches = [];\n    if (this.completionEndpoint) {\n      fetches.push(\n        getUrl(this.completionEndpoint).then(response => {\n          this.schema = response.json['context'] as CompletionSchema;\n          this.fnOptions = response.json['functions'] as CompletionOption[];\n        })\n      );\n    }\n\n    if (this.fieldsEndpoint) {\n      fetches.push(\n        getAssets(this.fieldsEndpoint).then((assets: Asset[]) => {\n          this.keyedAssets['fields'] = [];\n          assets.forEach((field: ContactField) => {\n            this.keyedAssets['fields'].push(field.key);\n            this.fields[field.key] = field;\n          });\n        })\n      );\n    }\n\n    if (this.globalsEndpoint) {\n      fetches.push(\n        getAssets(this.globalsEndpoint).then((assets: Asset[]) => {\n          this.keyedAssets['globals'] = assets.map((asset: Asset) => asset.key);\n        })\n      );\n    }\n\n    if (this.groupsEndpoint) {\n      fetches.push(\n        getAssets(this.groupsEndpoint).then((groups: any[]) => {\n          groups.forEach((group: any) => {\n            this.groups[group.uuid] = group;\n          });\n        })\n      );\n    }\n\n    this.httpComplete = Promise.all(fetches);\n  }\n\n  public setKeyedAssets(name: string, values: string[]): void {\n    this.keyedAssets[name] = values;\n  }\n\n  public updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n  }\n\n  public getCompletionSchema(): CompletionSchema {\n    return this.schema;\n  }\n\n  public getFunctions(): CompletionOption[] {\n    return this.fnOptions;\n  }\n\n  public getKeyedAssets(): KeyedAssets {\n    return this.keyedAssets;\n  }\n\n  public getContactField(key: string): ContactField {\n    return this.fields[key];\n  }\n\n  public isDynamicGroup(uuid: string): boolean {\n    const group = this.groups[uuid];\n    if (group && group.query) {\n      return true;\n    }\n    return false;\n  }\n}\n"]}