{"version":3,"file":"ContactDetails.js","sourceRoot":"","sources":["../../../src/contacts/ContactDetails.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, TemplateResult } from 'lit';\nimport { property } from 'lit/decorators';\nimport { Contact, Group, Ticket } from '../interfaces';\nimport { RapidElement } from '../RapidElement';\nimport { isDate, timeSince, truncate } from '../utils';\nimport { Store } from '../store/Store';\nimport { BODY_SNIPPET_LENGTH, fetchContact } from './helpers';\n\nexport class ContactDetails extends RapidElement {\n  static get styles() {\n    return css`\n      :host {\n        background: #f9f9f9;\n        display: block;\n        height: 100%;\n        position: relative;\n        overflow: hidden;\n        -webkit-mask-image: -webkit-radial-gradient(white, black);\n      }\n\n      .contact {\n        display: flex;\n        flex-direction: column;\n        align-items: stretch;\n        height: 100%;\n      }\n\n      .wrapper {\n        padding: 0em 1em;\n        flex-grow: 1;\n        display: flex;\n        flex-direction: column;\n      }\n\n      a {\n        color: var(--color-link-primary);\n      }\n\n      .field-links {\n        font-size: 0.8em;\n      }\n\n      .contact > .name {\n        font-size: 1.2em;\n        font-weight: 400;\n        padding: 0.5em 0.75em;\n        padding-right: 1em;\n      }\n\n      .group-label temba-icon {\n        display: inline-block;\n        fill: var(--color-text-dark);\n        margin-bottom: -2px;\n        margin-right: 4px;\n      }\n\n      .group-label {\n        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),\n          0 1px 2px 0 rgba(0, 0, 0, 0.06);\n        line-height: 1.25;\n        text-decoration: none;\n        cursor: default;\n        padding-left: 0.5rem;\n        padding-right: 0.5rem;\n        padding-top: 0.25rem;\n        padding-bottom: 0.25rem;\n        display: inline-block;\n        font-size: 0.75rem;\n        font-weight: 400;\n        border-radius: 9999px;\n        background-color: #f1f1f1;\n        color: rgba(0, 0, 0, 0.5);\n        letter-spacing: 0.025em;\n        white-space: nowrap;\n        text-align: center;\n        user-select: none;\n        -webkit-user-select: none;\n        margin-right: 0.75em;\n        margin-bottom: 0.75em;\n      }\n\n      .groups {\n        margin-top: 0.55em;\n        padding: 0px 0.75em;\n        margin-bottom: 0.3em;\n      }\n\n      .start-flow {\n      }\n\n      .actions {\n        margin-top: 16px;\n        border: 0px solid #ddd;\n        border-radius: var(--curvature);\n        padding: 0px;\n      }\n\n      .fields-wrapper {\n        background: #fff;\n        overflow: hidden;\n        margin: 0em -1em;\n\n        display: flex;\n        align-items: stretch;\n        flex-direction: column;\n        transition: all 300ms linear;\n      }\n\n      .fields-wrapper.expanded {\n        flex-grow: 2;\n      }\n\n      .body-wrapper {\n        overflow: hidden;\n      }\n\n      .body {\n        max-height: 200px;\n        overflow-y: auto;\n      }\n\n      .fields {\n        padding: 1em;\n        overflow-y: auto;\n      }\n\n      .fields-wrapper.expanded .fields {\n        flex-grow: 1;\n        height: 0px;\n      }\n\n      .field {\n        border-radius: var(--curvature);\n\n        display: flex;\n        flex-direction: column;\n        margin-bottom: 0.3em;\n      }\n\n      .field .name {\n        margin-right: 8px;\n        font-weight: 400;\n        color: #666;\n        font-size: 0.9em;\n        word-break: break-word;\n      }\n      .field .value {\n        font-size: 0.8em;\n        word-break: break-word;\n      }\n\n      temba-button {\n        margin-top: 5px;\n        display: block;\n        --button-y: 0;\n      }\n    `;\n  }\n\n  // optional display name\n  @property({ type: String })\n  name: string;\n\n  @property({ type: String })\n  uuid: string;\n\n  @property({ type: Object })\n  contact: Contact;\n\n  @property({ attribute: false })\n  flow: any = null;\n\n  // the fields with values for this contact\n  @property({ type: Array })\n  fields: string[] = [];\n\n  @property({ type: String })\n  endpoint: string;\n\n  @property({ type: Boolean })\n  expandFields = false;\n\n  @property({ type: Boolean })\n  expandBody = false;\n\n  @property({ type: Boolean })\n  showGroups = false;\n\n  @property({ type: Boolean })\n  showFlows = false;\n\n  @property({ type: Object })\n  ticket: Ticket = null;\n\n  public updated(changes: Map<string, any>) {\n    super.updated(changes);\n\n    if (changes.has('contact')) {\n      const store: Store = document.querySelector('temba-store');\n      if (this.contact && this.contact.fields) {\n        this.fields = Object.keys(this.contact.fields).filter((key: string) => {\n          const hasField = !!this.contact.fields[key];\n          return hasField && store.getContactField(key).pinned;\n        });\n\n        this.contact.groups.forEach((group: Group) => {\n          group.is_dynamic = store.isDynamicGroup(group.uuid);\n        });\n\n        this.contact.groups.sort((a: Group, b: Group) => {\n          if (a.is_dynamic) {\n            return -1;\n          }\n          if (b.is_dynamic) {\n            return 1;\n          }\n          return a.name.localeCompare(b.name);\n        });\n      }\n    }\n\n    if (changes.has('endpoint')) {\n      this.flow = null;\n      this.expandFields = false;\n      fetchContact(this.endpoint).then((contact: Contact) => {\n        this.contact = contact;\n      });\n    }\n  }\n\n  private handleFlowChanged(evt: CustomEvent) {\n    this.flow = evt.detail.selected as any;\n  }\n\n  private handleToggleFields(): void {\n    this.expandFields = !this.expandFields;\n  }\n\n  private handleExpandBody(): void {\n    this.expandBody = true;\n  }\n\n  private handleHideBody(): void {\n    this.expandBody = false;\n  }\n\n  public render(): TemplateResult {\n    const store: Store = document.querySelector('temba-store');\n\n    let body = this.ticket ? this.ticket.body : null;\n    const showBodyToggle = body ? body.length > BODY_SNIPPET_LENGTH : false;\n    if (\n      !this.expandBody &&\n      this.ticket &&\n      this.ticket.body.length > BODY_SNIPPET_LENGTH\n    ) {\n      body = truncate(this.ticket.body, BODY_SNIPPET_LENGTH);\n    }\n\n    if (this.contact) {\n      return html`<div class=\"contact\">\n        ${this.ticket\n          ? html`<div class=\"name\">${this.name || this.contact.name}</div>`\n          : null}\n        ${this.showGroups && !this.ticket\n          ? html`<div class=\"groups\">\n              ${this.contact.groups.map((group: Group) => {\n                return html`\n                  <div\n                    onclick=\"goto(event)\"\n                    href=\"/contact/filter/${group.uuid}/\"\n                    class=\"group-label\"\n                    style=\"cursor:pointer\"\n                  >\n                    ${group.is_dynamic\n                      ? html`<temba-icon name=\"atom\"></temba-icon>`\n                      : null}${group.name}\n                  </div>\n                `;\n              })}\n            </div>`\n          : html``}\n\n        <div class=\"wrapper\">\n          ${body\n            ? html`<div class=\"body-wrapper\">\n                <div class=\"body\">${body}</div>\n                <div class=\"field-links\">\n                  ${showBodyToggle\n                    ? !this.expandBody\n                      ? html`<a href=\"#\" @click=\"${this.handleExpandBody}\"\n                          >more</a\n                        >`\n                      : html`<a href=\"#\" @click=\"${this.handleHideBody}\"\n                          >less</a\n                        >`\n                    : null}\n                </div>\n              </div>`\n            : null}\n          ${this.fields.length > 0\n            ? html` <div\n                  class=\"fields-wrapper ${this.expandFields ? 'expanded' : ''}\"\n                >\n                  <div class=\"fields\">\n                    ${this.fields\n                      .slice(0, this.expandFields ? 255 : 3)\n                      .map((key: string) => {\n                        let value = this.contact.fields[key];\n                        if (value) {\n                          if (isDate(value)) {\n                            value = timeSince(new Date(value));\n                          }\n                          return html`<div class=\"field\">\n                            <div class=\"name\">\n                              ${store.getContactField(key).label}\n                            </div>\n                            <div class=\"value\">${value}</div>\n                          </div>`;\n                        }\n                      })}\n                  </div>\n                </div>\n                <div style=\"display:flex;\">\n                  <div style=\"flex-grow:1\"></div>\n                  <div style=\"margin-right:1em;margin-top:-0.5em\">\n                    ${this.fields.length > 3\n                      ? html`<temba-icon\n                          name=\"chevrons-${this.expandFields ? 'up' : 'down'}\"\n                          @click=${this.handleToggleFields}\n                          animateChange=\"spin\"\n                          circled\n                          clickable\n                        ></temba-icon>`\n                      : null}\n                  </div>\n                </div>`\n            : null}\n          <div style=\"flex-grow:1\"></div>\n        </div>\n      </div>`;\n    }\n  }\n}\n"]}