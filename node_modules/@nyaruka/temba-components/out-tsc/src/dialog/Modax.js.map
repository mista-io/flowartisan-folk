{"version":3,"file":"Modax.js","sourceRoot":"","sources":["../../../src/dialog/Modax.ts"],"names":[],"mappings":"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","sourcesContent":["import { TemplateResult, html, css } from 'lit';\nimport { property } from 'lit/decorators';\nimport { unsafeHTML } from 'lit-html/directives/unsafe-html';\n\nimport { RapidElement } from '../RapidElement';\nimport { getUrl, serialize, postUrl, WebResponse } from '../utils';\nimport { CustomEventType } from '../interfaces';\nimport { Dialog } from './Dialog';\n\nexport class Modax extends RapidElement {\n  static get styles() {\n    return css`\n      :host {\n      }\n\n      fieldset {\n        border: none;\n        margin: 0;\n        padding: 0;\n      }\n\n      .control-group {\n        margin-bottom: var(--control-margin-bottom);\n      }\n\n      .form-actions {\n        display: none;\n      }\n\n      .modax-body {\n        padding: 20px;\n        display: block;\n        position: relative;\n        background: var(--body-bg);\n      }\n\n      .modax-body.submitting:before {\n        display: inline-block;\n        content: '';\n        height: 100%;\n        width: 100%;\n        margin-left: -20px;\n        margin-top: -20px;\n        background: rgba(200, 200, 200, 0.1);\n        position: absolute;\n        z-index: 10000;\n      }\n\n      temba-dialog {\n        --transition-speed: var(--transition-speed);\n      }\n\n      temba-loading {\n        margin: 0 auto;\n        display: block;\n        width: 150px;\n      }\n\n      ul.errorlist {\n        margin-top: 0px;\n        list-style-type: none;\n        padding-left: 0;\n        padding-bottom: 7px;\n      }\n\n      ul.errorlist li {\n        color: var(--color-error);\n        background: rgba(255, 181, 181, 0.17);\n        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),\n          0 1px 2px 0 rgba(0, 0, 0, 0.06);\n        color: tomato;\n        padding: 10px;\n        margin-bottom: 10px;\n        border-radius: 6px;\n        font-weight: 300;\n      }\n    `;\n  }\n\n  @property({ type: String })\n  header = '';\n\n  @property({ type: String })\n  endpoint: string;\n\n  @property({ type: Boolean, reflect: true })\n  open = false;\n\n  @property({ type: Boolean })\n  fetching = false;\n\n  @property({ type: Boolean })\n  submitting: boolean;\n\n  @property({ type: String })\n  primaryName: string;\n\n  @property({ type: String })\n  cancelName: string;\n\n  @property({ type: String })\n  onLoaded: string;\n\n  @property({ type: Boolean })\n  noSubmit: boolean;\n\n  @property({ type: Object })\n  headers: any = {};\n\n  @property({ type: String })\n  body: any = this.getLoading();\n\n  @property({ type: Boolean })\n  disabled = false;\n\n  @property({ type: Boolean })\n  suspendSubmit = false;\n  // private cancelToken: CancelTokenSource;\n\n  // http promise to monitor for completeness\n  public httpComplete: Promise<void | WebResponse>;\n\n  private handleSlotClicked(): void {\n    this.open = true;\n  }\n\n  public updated(changes: Map<string, any>) {\n    super.updated(changes);\n\n    if (changes.has('open')) {\n      if (this.open) {\n        this.fetchForm();\n      } else {\n        // open can get reflected into undefined, make sure we've been open before\n        if (changes.get('open') !== undefined) {\n          // hide our body after our hiding animation is done\n          window.setTimeout(() => {\n            this.body = this.getLoading();\n            this.submitting = false;\n          }, 500);\n        }\n      }\n    }\n\n    if (changes.has('body') && this.open && this.body && !this.fetching) {\n      const dialog = this.shadowRoot.querySelector('temba-dialog') as Dialog;\n      dialog.focusFirstInput();\n    }\n  }\n\n  private getLoading() {\n    return html`<temba-loading units=\"6\" size=\"8\"></temba-loading>`;\n  }\n\n  private updatePrimaryButton(): void {\n    if (!this.noSubmit) {\n      window.setTimeout(() => {\n        const submitButton = this.shadowRoot.querySelector(\n          \"input[type='submit']\"\n        ) as any;\n\n        if (submitButton) {\n          this.primaryName = submitButton.value;\n        } else {\n          this.primaryName = null;\n          this.cancelName = 'Ok';\n        }\n\n        this.submitting = false;\n      }, 0);\n    }\n  }\n\n  private setBody(body: string): boolean {\n    // remove any existing on our previous body\n    const scriptBlock = this.shadowRoot.querySelector('.scripts') as any;\n    for (const child of scriptBlock.children) {\n      child.remove();\n    }\n\n    // parse out any scripts in the body\n    const div = this.ownerDocument.createElement('div');\n    div.innerHTML = body;\n    const scripts = div.getElementsByTagName('script');\n\n    // IE bleeds through, avoid bootstrap form spans that breaks layout\n    const spans = div.getElementsByClassName('span12') as any;\n    for (const span of spans) {\n      span.className = '';\n    }\n\n    const toAdd: any = [];\n    // now add them in\n    for (let i = scripts.length - 1; i >= 0; i--) {\n      // for (let i = 0; i < scripts.length; i++) {\n      const script = this.ownerDocument.createElement('script');\n      const code = scripts[i].innerText;\n\n      if (scripts[i].src) {\n        script.src = scripts[i].src;\n        script.type = 'text/javascript';\n        script.async = true;\n\n        // TODO: track and fire event once all scripts are loaded\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        script.onload = function () {};\n        toAdd.push(script);\n      } else if (code) {\n        script.appendChild(this.ownerDocument.createTextNode(code));\n        toAdd.push(script);\n        // remove it from our current body text\n      }\n      scripts[i].remove();\n    }\n\n    const scriptOnly = !!div.querySelector('.success-script');\n\n    if (!scriptOnly) {\n      this.body = unsafeHTML(div.innerHTML);\n    }\n\n    window.setTimeout(() => {\n      for (const script of toAdd) {\n        scriptBlock.appendChild(script);\n      }\n    }, 0);\n\n    return !scriptOnly;\n  }\n\n  public getHeaders(): any {\n    const headers = this.headers;\n    headers['X-PJAX'] = 1;\n    return headers;\n  }\n\n  private fetchForm() {\n    // const CancelToken = axios.CancelToken;\n    // this.cancelToken = CancelToken.source();\n    this.fetching = true;\n    this.body = this.getLoading();\n    this.httpComplete = getUrl(this.endpoint, null, this.getHeaders()).then(\n      (response: WebResponse) => {\n        this.setBody(response.body);\n        this.updatePrimaryButton();\n        this.fetching = false;\n        window.setTimeout(() => {\n          this.fireCustomEvent(CustomEventType.Loaded, {\n            body: this.getBody(),\n          });\n        }, 0);\n      }\n    );\n  }\n\n  public submit(): void {\n    this.submitting = true;\n    const form = this.shadowRoot.querySelector('form');\n    const postData = form ? serialize(form) : {};\n\n    this.httpComplete = postUrl(\n      this.endpoint,\n      postData,\n      this.getHeaders(),\n      'application/x-www-form-urlencoded'\n    )\n      .then((response: WebResponse) => {\n        window.setTimeout(() => {\n          let redirect = response.headers.get('temba-success');\n          if (\n            !redirect &&\n            response.url &&\n            response.url.indexOf(this.endpoint) === -1\n          ) {\n            redirect = response.url;\n          }\n\n          if (redirect) {\n            if (redirect === 'hide') {\n              window.setTimeout(() => {\n                this.open = false;\n                this.fireCustomEvent(CustomEventType.Submitted);\n              }, 0);\n            } else {\n              this.fireCustomEvent(CustomEventType.Redirected, {\n                url: redirect,\n              });\n              this.open = false;\n            }\n          } else {\n            // if we set the body, update our submit button\n            if (this.setBody(response.body)) {\n              this.updatePrimaryButton();\n            }\n          }\n        }, 1000);\n      })\n      .catch(error => {\n        console.error(error);\n      });\n  }\n\n  private handleDialogClick(evt: CustomEvent) {\n    const button = evt.detail.button;\n    if (!button.disabled && !button.submitting) {\n      if (button.name === this.primaryName) {\n        if (!this.suspendSubmit) {\n          this.submit();\n        }\n      }\n    }\n\n    if (button.name === (this.cancelName || 'Cancel')) {\n      this.open = false;\n      this.fetching = false;\n      this.cancelName = undefined;\n    }\n  }\n\n  private handleDialogHidden() {\n    // this.cancelToken.cancel();\n    this.open = false;\n    this.fetching = false;\n  }\n\n  private isDestructive(): boolean {\n    return this.endpoint && this.endpoint.indexOf('delete') > -1;\n  }\n\n  public getBody() {\n    return this.shadowRoot.querySelector('.modax-body');\n  }\n\n  public render(): TemplateResult {\n    return html`\n      <temba-dialog\n        header=${this.header}\n        .primaryButtonName=${this.noSubmit ? null : this.primaryName}\n        .cancelButtonName=${this.cancelName || 'Cancel'}\n        ?open=${this.open}\n        ?loading=${this.fetching}\n        ?submitting=${this.submitting}\n        ?destructive=${this.isDestructive()}\n        ?noFocus=${true}\n        ?disabled=${this.disabled}\n        @temba-button-clicked=${this.handleDialogClick.bind(this)}\n        @temba-dialog-hidden=${this.handleDialogHidden.bind(this)}\n      >\n        <div class=\"modax-body${this.submitting ? ' submitting' : ''}\">\n          ${this.body}\n        </div>\n        <div class=\"scripts\"></div>\n      </temba-dialog>\n      <div class=\"slot-wrapper\" @click=${this.handleSlotClicked}>\n        <slot></slot>\n      </div>\n    `;\n  }\n}\n"]}