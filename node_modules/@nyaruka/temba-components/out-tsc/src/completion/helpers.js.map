{"version":3,"file":"helpers.js","sourceRoot":"","sources":["../../../src/completion/helpers.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, TemplateResult } from 'lit';\nimport { unsafeHTML } from 'lit-html/directives/unsafe-html';\nimport { directive, Directive, Part, PartInfo, PartType } from 'lit/directive';\nimport ExcellentParser, { Expression } from './ExcellentParser';\nimport {\n  CompletionOption,\n  CompletionProperty,\n  CompletionResult,\n  CompletionSchema,\n  CompletionType,\n  KeyedAssets,\n} from '../interfaces';\nimport { Store } from '../store/Store';\nimport { Remarkable } from 'remarkable';\n\nconst md = new Remarkable();\n\nconst messageParser = new ExcellentParser('@', [\n  'contact',\n  'fields',\n  'globals',\n  'urns',\n]);\n\nconst sessionParser = new ExcellentParser('@', [\n  'contact',\n  'fields',\n  'globals',\n  'urns',\n  'results',\n  'input',\n  'run',\n  'child',\n  'parent',\n  'node',\n  'webhook',\n  'ticket',\n  'trigger',\n  'resume',\n]);\n\n// Class-based directive API\nexport class RenderMarkdown extends Directive {\n  // State stored in class field\n  value: string | undefined;\n  constructor(partInfo: PartInfo) {\n    super(partInfo);\n    // When necessary, validate part in constructor using `part.type`\n    if (partInfo.type !== PartType.CHILD) {\n      throw new Error('renderMarkdown only supports child expressions');\n    }\n  }\n  // Optional: override update to perform any direct DOM manipulation\n  // DirectiveParameters<this>\n  update(part: Part, [initialValue]: any) {\n    /* Any imperative updates to DOM/parts would go here */\n    return this.render(initialValue);\n  }\n  // Do SSR-compatible rendering (arguments are passed from call site)\n  render(initialValue: string) {\n    // Previous state available on class field\n    if (this.value === undefined) {\n      this.value = initialValue;\n    }\n    return html`${unsafeHTML(md.render(this.value))}`;\n  }\n}\n\nexport const renderMarkdown = directive(RenderMarkdown);\n\nexport const renderCompletionOption = (\n  option: CompletionOption,\n  selected: boolean\n): TemplateResult => {\n  if (option.signature) {\n    const argStart = option.signature.indexOf('(');\n    const name = option.signature.substr(0, argStart);\n    const args = option.signature.substr(argStart);\n\n    return html`\n      <div style=\"${selected ? 'font-weight: 400' : ''}\">\n        <div style=\"display:inline-block;margin-right: 5px\">ƒ</div>\n        <div style=\"display:inline-block\">${name}</div>\n        ${selected\n          ? html`\n              <div\n                style=\"display:inline-block; font-weight: 300; font-size: 85%\"\n              >\n                ${args}\n              </div>\n              <div class=\"detail\">${renderMarkdown(option.summary)}</div>\n            `\n          : null}\n      </div>\n    `;\n  }\n\n  return html`\n    <div>\n      <div style=\"${selected ? 'font-weight: 400' : ''}\">${option.name}</div>\n      ${selected\n        ? html` <div style=\"font-size: 85%\">${option.summary}</div> `\n        : null}\n    </div>\n  `;\n};\n\nexport const getFunctions = (\n  functions: CompletionOption[],\n  query: string\n): CompletionOption[] => {\n  if (!query) {\n    return functions;\n  }\n  return functions.filter((option: CompletionOption) => {\n    if (option.signature) {\n      return option.signature.indexOf((query || '').toLowerCase()) === 0;\n    }\n    return false;\n  });\n};\n\n/**\n * Takes a dot query and returns the completions options at the current level\n * @param dotQuery query such as \"contact.first_n\"\n */\nexport const getCompletions = (\n  schema: CompletionSchema,\n  dotQuery: string,\n  keyedAssets: KeyedAssets = {},\n  session: boolean\n): CompletionOption[] => {\n  const parts = (dotQuery || '').split('.');\n  let currentProps: CompletionProperty[] = session\n    ? schema.root\n    : schema.root_no_session;\n\n  if (!currentProps) {\n    return [];\n  }\n\n  let prefix = '';\n  let part = '';\n  while (parts.length > 0) {\n    part = parts.shift();\n    if (part) {\n      // eslint-disable-next-line\n      const nextProp = currentProps.find(\n        (prop: CompletionProperty) => prop.key === part\n      );\n      if (nextProp) {\n        // eslint-disable-next-line\n        const nextType = schema.types.find(\n          (type: CompletionType) => type.name === nextProp.type\n        );\n        if (nextType && nextType.properties) {\n          currentProps = nextType.properties;\n          prefix += part + '.';\n        } else if (nextType && nextType.property_template) {\n          prefix += part + '.';\n          const template = nextType.property_template;\n          if (keyedAssets[nextType.name]) {\n            currentProps = keyedAssets[nextType.name].map((key: string) => ({\n              key: template.key.replace('{key}', key),\n              help: template.help.replace('{key}', key),\n              type: template.type,\n            }));\n          } else {\n            currentProps = [];\n          }\n        } else {\n          // eslint-disable-next-line\n          currentProps = currentProps.filter((prop: CompletionProperty) =>\n            prop.key.startsWith(part.toLowerCase())\n          );\n          break;\n        }\n      } else {\n        // eslint-disable-next-line\n        currentProps = currentProps.filter((prop: CompletionProperty) =>\n          prop.key.startsWith(part.toLowerCase())\n        );\n        break;\n      }\n    }\n  }\n\n  return currentProps.map((prop: CompletionProperty) => {\n    const name =\n      prop.key === '__default__'\n        ? prefix.substr(0, prefix.length - 1)\n        : prefix + prop.key;\n    return { name, summary: prop.help };\n  });\n};\n\nexport const getOffset = (el: HTMLElement) => {\n  const rect = el.getBoundingClientRect(),\n    scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n    scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n  return { top: rect.top + scrollTop, left: rect.left + scrollLeft };\n};\n\nexport const getVerticalScroll = (ele: Node) => {\n  let current = ele;\n  const verticalScroll = 0;\n  while (current) {\n    current = current.parentNode;\n  }\n  return verticalScroll;\n};\n\nexport const getCompletionName = (option: CompletionOption): string => {\n  return (\n    option.name || option.signature.substr(0, option.signature.indexOf('('))\n  );\n};\n\nexport const getCompletionSignature = (option: CompletionOption): string => {\n  return option.signature.substr(option.signature.indexOf('('));\n};\n\n/**\n * Determines the pixel position of position inside a textarea or input\n * TODO: Explore somethign like contenteditable to avoid this madness\n * see: https://jh3y.medium.com/how-to-where-s-the-caret-getting-the-xy-position-of-the-caret-a24ba372990a\n */\nconst getCursorXY = (input, selectionPoint) => {\n  const { offsetLeft: inputX, offsetTop: inputY } = input;\n  const div = document.createElement('div');\n  const copyStyle = getComputedStyle(input);\n  for (const prop of copyStyle) {\n    div.style[prop] = copyStyle[prop];\n  }\n  div.style.position = 'relative';\n  const swap = '.';\n  const inputValue =\n    input.tagName === 'INPUT' ? input.value.replace(/ /g, swap) : input.value;\n  const textContent = inputValue.substr(0, selectionPoint);\n  div.textContent = textContent;\n  if (input.tagName === 'TEXTAREA') div.style.height = 'auto';\n  if (input.tagName === 'INPUT') div.style.width = 'auto';\n  const span = document.createElement('span');\n  span.textContent = inputValue.substr(selectionPoint) || '.';\n  div.appendChild(span);\n  document.body.appendChild(div);\n  const { offsetLeft: spanX, offsetTop: spanY } = span;\n  document.body.removeChild(div);\n  return {\n    left: inputX + spanX,\n    top: inputY + spanY,\n  };\n};\n\nexport const updateInputElementWithCompletion = (\n  currentQuery: string,\n  ele: HTMLInputElement,\n  option: CompletionOption\n) => {\n  let insertText = '';\n\n  if (option.signature) {\n    // they selected a function\n    insertText = option.signature.substr(0, option.signature.indexOf('(') + 1);\n  } else {\n    insertText = option.name;\n  }\n\n  const queryLength = currentQuery.length;\n\n  if (ele) {\n    const value = ele.value;\n    const insertionPoint = ele.selectionStart - queryLength;\n\n    // strip out our query\n    // const insertionPoint = value.lastIndexOf(value.substring(0, this.inputElement.selectionStart));\n    const leftSide = value.substr(0, insertionPoint);\n    const remaining = value.substr(insertionPoint + queryLength);\n    const caret = leftSide.length + insertText.length;\n\n    // set our value and our new caret\n    ele.value = leftSide + insertText + remaining;\n    ele.setSelectionRange(caret, caret);\n\n    // now scroll our text box if necessary\n    const position = getCursorXY(ele, caret);\n    if (position.left > ele.width) {\n      ele.scrollLeft = position.left;\n    }\n\n    ele.dispatchEvent(new Event('input'));\n  }\n};\n\nexport const executeCompletionQuery = (\n  ele: HTMLInputElement,\n  store: Store,\n  session: boolean\n): CompletionResult => {\n  const result: CompletionResult = {\n    currentFunction: null,\n    options: [],\n    anchorPosition: null,\n    query: null,\n  };\n\n  // we need a store to do anything useful\n  if (!store) {\n    return result;\n  }\n\n  const cursor = ele.selectionStart;\n  const input = ele.value.substring(0, cursor);\n\n  const parser = session ? sessionParser : messageParser;\n  const expressions = parser.findExpressions(input);\n  const currentExpression = expressions.find(\n    (expr: Expression) =>\n      expr.start <= cursor &&\n      (expr.end > cursor || (expr.end === cursor && !expr.closed))\n  );\n\n  if (currentExpression) {\n    const includeFunctions = currentExpression.text.indexOf('(') > -1;\n    if (includeFunctions) {\n      const functionQuery = parser.functionContext(currentExpression.text);\n      if (functionQuery) {\n        const fns = getFunctions(store.getFunctions(), functionQuery);\n        if (fns.length > 0) {\n          result.currentFunction = fns[0];\n        }\n      }\n    }\n\n    for (let i = currentExpression.text.length; i >= 0; i--) {\n      const curr = currentExpression.text[i];\n      if (\n        curr === '@' ||\n        curr === '(' ||\n        curr === ' ' ||\n        curr === ',' ||\n        curr === ')' ||\n        i === 0\n      ) {\n        // don't include non-expression chars\n        if (\n          curr === '(' ||\n          curr === ' ' ||\n          curr === ',' ||\n          curr === ')' ||\n          curr === '@'\n        ) {\n          i++;\n        }\n\n        const caret = getCursorXY(ele, currentExpression.start + i);\n\n        result.anchorPosition = {\n          left: caret.left - 2 - ele.scrollLeft,\n          top: caret.top - ele.scrollTop,\n        };\n\n        result.query = currentExpression.text.substr(\n          i,\n          currentExpression.text.length - i\n        );\n\n        result.options = [\n          ...getCompletions(\n            store.getCompletionSchema(),\n            result.query,\n            store.getKeyedAssets(),\n            session\n          ),\n          ...(includeFunctions\n            ? getFunctions(store.getFunctions(), result.query)\n            : []),\n        ];\n\n        return result;\n      }\n    }\n  } else {\n    result.options = [];\n    result.query = '';\n  }\n  return result;\n};\n"]}